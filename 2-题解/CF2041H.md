---
tags:
  - 题解
  - DP
aliases:
---
## []()

我们先尝试构造一个仅包含 $\texttt{>}$ 和 $\texttt{<}$ 的、长度为 $i$ 的不等号序列，第 $i$ 位上的符号表示 $a_{i-1}$ 与 $a_i$ 的相对大小关系。这个不等号序列应该满足一个限制条件：连续的不等号段长度不超过 $k-1$，因为如果有 $k$ 个连续的不等号，$a$ 中就需要至少 $k+1$ 个数字，这与值域 $[1,k]$ 的限制相违背。
记 $dp[z][i]$ 表示第 $i$ 与第 $i-1$ 位关系为 $z$ 的方案数，其中，$z=0$ 表示 $a_{i-1}<a_i$，$z=1$ 表示 $a_{i-1}>a_i$。记 $sum[z][i]=\sum_{k=1}^idp[z][k]$。
考虑第 $i$ 位填 $\texttt{>}$ 的情况，前 $i-1$ 个位置上可以以 $\texttt{<}$ 结尾，可以以 $\texttt{<},\texttt{>}$ 结尾，可以以 $\texttt{<},\texttt{>},\texttt{>}$ 结尾……，可以以 $\texttt{<},\underbrace{\texttt{>},\texttt{>},\cdots,\texttt{>},\texttt{>}}_{k-1 \text{个} \texttt{>}}$ 结尾。对应的方案数分别为 $dp[0][i-1],dp[0][i-2],\cdots,dp[0][i-k]$。于是状态转移方程为：
$$
dp[z][i] = \begin{cases}
sum[z\textasciicircum 1][i-1]-sum[z\textasciicircum 1][i-k-1] & i-k-1\geq0 \\
sum[z\textasciicircum 1][i-1] & i-k-1<0
\end{cases}
$$
完成 $dp$ 的更新后对应维护 $sum$ 即可。

#### [AC 代码]()

```cpp

```
